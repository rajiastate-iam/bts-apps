name: Publish Auth0 Registration

on:
  push:
    branches: [main]
    paths:
      - "apps/*.yaml"
      - "apps/*.yml"
  workflow_dispatch:
    inputs:
      file:
        description: "Optional: path to apps/<file>.yaml"
        required: false
        type: string

# ðŸ”’ READ ONLY
permissions:
  contents: read

jobs:
  detect-and-encode:
    runs-on: ubuntu-latest
    outputs:
      org: ${{ steps.meta.outputs.org }}
      app: ${{ steps.meta.outputs.app }}
      env: ${{ steps.meta.outputs.env }}
      yaml_path: ${{ steps.pick.outputs.file }}
      yaml_b64: ${{ steps.b64.outputs.yaml_b64 }}
      src_repo: ${{ github.repository }}
      src_sha: ${{ github.sha }}

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

   

  call-auth0-apps:
    needs: detect-and-encode

    # ðŸ”’ still read-only
    permissions:
      contents: read

    uses: rajiastate-iam/auth0-apps/.github/workflows/reusable-receive-app.yml@master
    with:
      org:       ${{ needs.detect-and-encode.outputs.org }}
      app:       ${{ needs.detect-and-encode.outputs.app }}
      env:       ${{ needs.detect-and-encode.outputs.env }}
      yaml_path: ${{ needs.detect-and-encode.outputs.yaml_path }}
      yaml_b64:  ${{ needs.detect-and-encode.outputs.yaml_b64 }}
      src_repo:  ${{ needs.detect-and-encode.outputs.src_repo }}
      src_sha:   ${{ needs.detect-and-encode.outputs.src_sha }}
